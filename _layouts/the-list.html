<!DOCTYPE html>
<html lang="en">

{% include list-head.html %}

<body>

  <nav class="fl-nav hidden">
    <header>
      <h1 class="fl-nav-header">FLOURISH</h1>
      <button id="menu-toggle" type="button" aria-controls="MobileNav" aria-expanded="true" aria-label="Menu">
        <svg
          aria-hidden="true"
          focusable="false"
          role="presentation"
          class="icon icon-hamburger"
          viewBox="0 0 37 40">
          <path d="M33.5 25h-30c-1.1 0-2-.9-2-2s.9-2 2-2h30c1.1 0 2 .9 2 2s-.9 2-2 2zm0-11.5h-30c-1.1 0-2-.9-2-2s.9-2 2-2h30c1.1 0 2 .9 2 2s-.9 2-2 2zm0 23h-30c-1.1 0-2-.9-2-2s.9-2 2-2h30c1.1 0 2 .9 2 2s-.9 2-2 2z"></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          role="presentation"
          class="icon icon-close"
          viewBox="0 0 40 40">
          <path d="M23.868 20.015L39.117 4.78c1.11-1.108 1.11-2.77 0-3.877-1.109-1.108-2.773-1.108-3.882 0L19.986 16.137 4.737.904C3.628-.204 1.965-.204.856.904c-1.11 1.108-1.11 2.77 0 3.877l15.249 15.234L.855 35.248c-1.108 1.108-1.108 2.77 0 3.877.555.554 1.248.831 1.942.831s1.386-.277 1.94-.83l15.25-15.234 15.248 15.233c.555.554 1.248.831 1.941.831s1.387-.277 1.941-.83c1.11-1.109 1.11-2.77 0-3.878L23.868 20.015z" class="layer"></path>
        </svg>
      </button>
    </header>
    <ul class="fl-nav-list">
      <li class="fl-nav-item"><a href="https://letsflourish.co">Home</a></li>
      <li class="fl-nav-item active"><a href="https://thelist.letsflourish.co">Browse Stores</a></li>
      <li class="fl-nav-item"><a href="https://letsflourish.co/for-businesses">For Businesses</a></li>
      <li class="fl-nav-item"><a href="https://letsflourish.co/contact-us">Cointact us</a></li>
    </ul>
  </nav>

  <!-- header -->
  <header class="header bg-img-right text-white">
    <div class="container text-center">
      <div class="row align-items-center py-4">
				<div class="col-md-3 col-xs-12"></div>
        <div class="col-md-6 col-xs-12">
          <h1 class="display-3">
            <strong>The Flourish List</strong>
          </h1>
          <p class="lead-3">
						A directory of businesses providing new products, delivery options and offers during the COVID-19 crisis.
					</p>
          <p class="gap-xy">
            <a class="btn px-6 btn-flourish" href="https://letsflourish.co ">Learn more about Flourish</a>
          </p>
          <br />
          <p>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSePTw6SCO9HeB23fuYvb3b3oaCNBMTkIcnJBEnMTNMLVnWzUA/viewform">Submit a business to the list here</a>
          </p>
        </div>
      </div>
    </div>
  </header>

  
  <section class="section overflow-hidden bg-gray ">
    <div class="container ">
      <h3 class="text-center">Discover deals, delivery and more</h3>

      <!-- TODO: break into _includes: the list -->
      <ul class="nav nav-center nav-bold nav-uppercase nav-pills mb-2 ">
        <li class="nav-item">
          <button class="btn btn-flourish active"
            filter-by="[data-type]">
            All
          </button>
        </li>
        {% assign types = site.data.businesses | where: "publish", "yes" | map: "tag1" | uniq | compact %}
        {% for type in types %}
        <li class="nav-item ">
          <button class="btn btn-flourish"
            filter-by="[data-type='{{type}}']">
            {{type}}
          </button>
        </li>
        {% endfor %}
        <br />
      </ul>

      <div style="height: 42px; display: flex; justify-content: center;">
        <select name="" id="area-filter">
          <option value="[data-area]">All locations</option>
          {% assign city_regions = site.data.businesses | where: "publish", "yes" | map: "area" | uniq | compact %}
          {% for city_region in city_regions %}
          <option value="[data-area='{{city_region}}']">{{city_region}}</option>
          {% endfor %}
        </select>
      </div>

      <div id="business-list" class="container">
        {{ content }}
      </div>
  </section>

  {% include site-footer.md %}

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="/js/jquery.nice-select.min.js"></script>

  <!-- List js -->
  <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>

  <!-- TODO: move into script.js -->
  <script>
    const init = () => {
      console.log('init');

      $('#area-filter').niceSelect();

      const selector = '#business-list';
      const itemSelector = '.business';

      var $grid = $(selector).isotope({
        itemSelector,
        layoutMode: 'vertical'
      });

      const initialFilter = {
        area: "[data-area]",
        type: "[data-type]"
      }
      let currentFilter = { ...initialFilter };
      
      function applyFilter(f) {
        const filter = `${f.type}${f.area}`;
        console.log('applying: ', filter)
        $grid.isotope({ filter });
      }

      
      $('select#area-filter').on('change', ev => {
        currentFilter.area = ev.target.value;
        applyFilter(currentFilter);
      })
      
      $('.nav-item > .btn.btn-flourish').on('click', ev => {
        currentFilter.type = ev.target.getAttribute('filter-by');
        applyFilter(currentFilter);
        $('button[filter-by]').removeClass('active');
        $(ev.target).addClass('active');
      });

      // nav
      $('#menu-toggle').on('click', ev => {
        $('nav.fl-nav').toggleClass('hidden');
      });

    }

    $(document).ready(init);
  </script>

</body>
</html>